
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/deep/plot_divergence.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_deep_plot_divergence.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_deep_plot_divergence.py:


Divergence domain adaptation methods.
==========================================

This example illustrates the DeepCoral method from [1]
on a simple image classification task.

.. [1]  Baochen Sun and Kate Saenko. Deep coral:
        Correlation alignment for deep domain
        adaptation. In ECCV Workshops, 2016.

.. GENERATED FROM PYTHON SOURCE LINES 13-18

.. code-block:: Python

    # Author: Théo Gnassounou
    #
    # License: BSD 3-Clause
    # sphinx_gallery_thumbnail_number = 4








.. GENERATED FROM PYTHON SOURCE LINES 19-26

.. code-block:: Python

    from skorch import NeuralNetClassifier
    from torch import nn

    from skada.datasets import load_mnist_usps
    from skada.deep import DeepCoral
    from skada.deep.modules import MNISTtoUSPSNet








.. GENERATED FROM PYTHON SOURCE LINES 27-29

Load the image datasets
----------------------------------------------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 29-34

.. code-block:: Python


    dataset = load_mnist_usps(n_classes=2, n_samples=0.5, return_dataset=True)
    X, y, sample_domain = dataset.pack_train(as_sources=["mnist"], as_targets=["usps"])
    X_test, y_test, sample_domain_test = dataset.pack_test(as_targets=["usps"])





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to ./datasets/MNIST/raw/train-images-idx3-ubyte.gz
      0%|          | 0/9912422 [00:00<?, ?it/s]      0%|          | 32768/9912422 [00:00<03:41, 44578.15it/s]      1%|          | 65536/9912422 [00:01<04:21, 37601.98it/s]      1%|          | 98304/9912422 [00:02<04:37, 35333.71it/s]      1%|▏         | 131072/9912422 [00:03<04:44, 34360.23it/s]      2%|▏         | 163840/9912422 [00:04<04:51, 33444.85it/s]      2%|▏         | 196608/9912422 [00:05<04:55, 32917.42it/s]      2%|▏         | 229376/9912422 [00:06<04:57, 32589.98it/s]      3%|▎         | 262144/9912422 [00:07<04:58, 32380.43it/s]      3%|▎         | 294912/9912422 [00:08<04:58, 32240.21it/s]      3%|▎         | 327680/9912422 [00:09<04:58, 32146.36it/s]      4%|▎         | 360448/9912422 [00:10<04:57, 32081.72it/s]      4%|▍         | 393216/9912422 [00:11<04:54, 32346.39it/s]      4%|▍         | 425984/9912422 [00:12<04:50, 32688.59it/s]      5%|▍         | 458752/9912422 [00:13<04:51, 32458.30it/s]      5%|▍         | 491520/9912422 [00:14<04:51, 32299.77it/s]      5%|▌         | 524288/9912422 [00:15<04:51, 32189.74it/s]      6%|▌         | 557056/9912422 [00:16<04:51, 32113.23it/s]      6%|▌         | 589824/9912422 [00:17<04:50, 32059.87it/s]      6%|▋         | 622592/9912422 [00:19<04:50, 32022.36it/s]      7%|▋         | 655360/9912422 [00:20<04:49, 31996.81it/s]      7%|▋         | 688128/9912422 [00:21<04:45, 32281.85it/s]      7%|▋         | 720896/9912422 [00:21<04:40, 32797.19it/s]      8%|▊         | 753664/9912422 [00:22<04:37, 33006.41it/s]      8%|▊         | 786432/9912422 [00:23<04:35, 33155.68it/s]      8%|▊         | 819200/9912422 [00:24<04:32, 33422.43it/s]      9%|▊         | 851968/9912422 [00:25<04:33, 33124.11it/s]      9%|▉         | 884736/9912422 [00:26<04:32, 33076.01it/s]      9%|▉         | 917504/9912422 [00:27<04:30, 33206.25it/s]     10%|▉         | 950272/9912422 [00:28<04:27, 33458.28it/s]     10%|▉         | 983040/9912422 [00:29<04:25, 33638.18it/s]     10%|█         | 1015808/9912422 [00:30<04:24, 33598.94it/s]     11%|█         | 1048576/9912422 [00:31<04:22, 33736.95it/s]     11%|█         | 1081344/9912422 [00:32<04:22, 33667.51it/s]     11%|█         | 1114112/9912422 [00:33<04:20, 33786.33it/s]     12%|█▏        | 1146880/9912422 [00:34<04:18, 33868.00it/s]     12%|█▏        | 1179648/9912422 [00:35<04:17, 33927.71it/s]     12%|█▏        | 1212416/9912422 [00:36<04:16, 33972.28it/s]     13%|█▎        | 1245184/9912422 [00:37<04:14, 33999.25it/s]     13%|█▎        | 1277952/9912422 [00:38<04:13, 34018.68it/s]     13%|█▎        | 1310720/9912422 [00:39<04:12, 34031.18it/s]     14%|█▎        | 1343488/9912422 [00:40<04:12, 33872.25it/s]     14%|█▍        | 1376256/9912422 [00:41<04:15, 33429.93it/s]     14%|█▍        | 1409024/9912422 [00:42<04:17, 32967.96it/s]     15%|█▍        | 1441792/9912422 [00:43<04:19, 32653.11it/s]     15%|█▍        | 1474560/9912422 [00:44<04:20, 32435.18it/s]     15%|█▌        | 1507328/9912422 [00:45<04:10, 33554.99it/s]     16%|█▌        | 1540096/9912422 [00:46<04:08, 33707.20it/s]     16%|█▌        | 1572864/9912422 [00:47<04:06, 33813.47it/s]     16%|█▌        | 1605632/9912422 [00:48<04:07, 33553.79it/s]     17%|█▋        | 1638400/9912422 [00:49<04:10, 33052.23it/s]     17%|█▋        | 1671168/9912422 [00:50<04:11, 32710.24it/s]     17%|█▋        | 1703936/9912422 [00:51<04:12, 32474.39it/s]     18%|█▊        | 1736704/9912422 [00:52<04:13, 32311.38it/s]     18%|█▊        | 1769472/9912422 [00:53<04:11, 32350.03it/s]     18%|█▊        | 1802240/9912422 [00:54<04:06, 32845.66it/s]     19%|█▊        | 1835008/9912422 [00:55<04:03, 33202.55it/s]     19%|█▉        | 1867776/9912422 [00:56<03:58, 33787.52it/s]     19%|█▉        | 1900544/9912422 [00:57<03:56, 33868.73it/s]     20%|█▉        | 1933312/9912422 [00:58<03:59, 33267.97it/s]     20%|█▉        | 1966080/9912422 [00:59<04:01, 32856.21it/s]     20%|██        | 1998848/9912422 [01:00<04:01, 32731.00it/s]     20%|██        | 2031616/9912422 [01:01<04:02, 32488.54it/s]     21%|██        | 2064384/9912422 [01:02<04:02, 32322.49it/s]     21%|██        | 2097152/9912422 [01:03<04:01, 32357.95it/s]     21%|██▏       | 2129920/9912422 [01:04<04:00, 32382.89it/s]     22%|██▏       | 2162688/9912422 [01:05<04:00, 32247.60it/s]     22%|██▏       | 2195456/9912422 [01:06<04:00, 32153.81it/s]     22%|██▏       | 2228224/9912422 [01:07<03:59, 32088.35it/s]     23%|██▎       | 2260992/9912422 [01:08<03:58, 32046.99it/s]     23%|██▎       | 2293760/9912422 [01:09<03:57, 32015.78it/s]     23%|██▎       | 2326528/9912422 [01:10<03:57, 31995.41it/s]     24%|██▍       | 2359296/9912422 [01:11<03:56, 31978.49it/s]     24%|██▍       | 2392064/9912422 [01:12<03:55, 31968.59it/s]     24%|██▍       | 2424832/9912422 [01:13<03:54, 31961.80it/s]     25%|██▍       | 2457600/9912422 [01:14<03:53, 31956.43it/s]     25%|██▌       | 2490368/9912422 [01:15<03:52, 31953.09it/s]     25%|██▌       | 2523136/9912422 [01:16<03:51, 31950.08it/s]     26%|██▌       | 2555904/9912422 [01:17<03:48, 32250.33it/s]     26%|██▌       | 2588672/9912422 [01:18<03:43, 32775.89it/s]     26%|██▋       | 2621440/9912422 [01:19<03:40, 32995.27it/s]     27%|██▋       | 2654208/9912422 [01:20<03:38, 33149.15it/s]     27%|██▋       | 2686976/9912422 [01:21<03:37, 33258.11it/s]     27%|██▋       | 2719744/9912422 [01:22<03:34, 33498.19it/s]     28%|██▊       | 2752512/9912422 [01:23<03:32, 33668.07it/s]     28%|██▊       | 2785280/9912422 [01:24<03:31, 33622.98it/s]     28%|██▊       | 2818048/9912422 [01:25<03:30, 33754.87it/s]     29%|██▉       | 2850816/9912422 [01:26<03:28, 33851.22it/s]     29%|██▉       | 2883584/9912422 [01:27<03:29, 33581.92it/s]     29%|██▉       | 2916352/9912422 [01:28<03:27, 33730.65it/s]     30%|██▉       | 2949120/9912422 [01:29<03:25, 33831.82it/s]     30%|███       | 2981888/9912422 [01:30<03:24, 33900.87it/s]     30%|███       | 3014656/9912422 [01:31<03:23, 33954.93it/s]     31%|███       | 3047424/9912422 [01:32<03:23, 33655.43it/s]     31%|███       | 3080192/9912422 [01:33<03:26, 33124.22it/s]     31%|███▏      | 3112960/9912422 [01:34<03:27, 32760.53it/s]     32%|███▏      | 3145728/9912422 [01:35<03:28, 32512.69it/s]     32%|███▏      | 3178496/9912422 [01:36<03:26, 32648.97it/s]     32%|███▏      | 3211264/9912422 [01:37<03:23, 32905.52it/s]     33%|███▎      | 3244032/9912422 [01:38<03:21, 33087.36it/s]     33%|███▎      | 3276800/9912422 [01:39<03:19, 33212.17it/s]     33%|███▎      | 3309568/9912422 [01:40<03:17, 33466.62it/s]     34%|███▎      | 3342336/9912422 [01:41<03:15, 33644.29it/s]     34%|███▍      | 3375104/9912422 [01:42<03:13, 33769.96it/s]     34%|███▍      | 3407872/9912422 [01:43<03:13, 33691.59it/s]     35%|███▍      | 3440640/9912422 [01:44<03:11, 33802.75it/s]     35%|███▌      | 3473408/9912422 [01:45<03:10, 33881.54it/s]     35%|███▌      | 3506176/9912422 [01:46<03:08, 33938.52it/s]     36%|███▌      | 3538944/9912422 [01:46<03:07, 33979.40it/s]     36%|███▌      | 3571712/9912422 [01:47<03:07, 33837.91it/s]     36%|███▋      | 3604480/9912422 [01:48<03:06, 33909.14it/s]     37%|███▋      | 3637248/9912422 [01:49<03:07, 33457.92it/s]     37%|███▋      | 3670016/9912422 [01:50<03:06, 33476.60it/s]     37%|███▋      | 3702784/9912422 [01:51<03:05, 33487.31it/s]     38%|███▊      | 3735552/9912422 [01:52<03:03, 33662.05it/s]     38%|███▊      | 3768320/9912422 [01:53<03:01, 33788.47it/s]     38%|███▊      | 3801088/9912422 [01:54<03:00, 33875.35it/s]     39%|███▊      | 3833856/9912422 [01:55<02:59, 33937.65it/s]     39%|███▉      | 3866624/9912422 [01:56<02:57, 33982.27it/s]     39%|███▉      | 3899392/9912422 [01:57<02:56, 34012.03it/s]     40%|███▉      | 3932160/9912422 [01:58<02:56, 33862.20it/s]     40%|███▉      | 3964928/9912422 [01:59<02:55, 33928.10it/s]     40%|████      | 3997696/9912422 [02:00<02:50, 34664.22it/s]     41%|████      | 4030464/9912422 [02:01<02:49, 34661.05it/s]     41%|████      | 4063232/9912422 [02:02<02:47, 35013.95it/s]     41%|████▏     | 4096000/9912422 [02:03<02:48, 34550.41it/s]     42%|████▏     | 4128768/9912422 [02:04<02:51, 33727.51it/s]     42%|████▏     | 4161536/9912422 [02:05<02:53, 33171.97it/s]     42%|████▏     | 4194304/9912422 [02:06<02:54, 32797.30it/s]     43%|████▎     | 4227072/9912422 [02:07<02:54, 32533.51it/s]     43%|████▎     | 4259840/9912422 [02:08<02:54, 32357.00it/s]     43%|████▎     | 4292608/9912422 [02:09<02:54, 32231.57it/s]     44%|████▎     | 4325376/9912422 [02:10<02:53, 32146.72it/s]     44%|████▍     | 4358144/9912422 [02:11<02:53, 32086.71it/s]     44%|████▍     | 4390912/9912422 [02:12<02:49, 32659.43it/s]     45%|████▍     | 4423680/9912422 [02:13<02:46, 32912.67it/s]     45%|████▍     | 4456448/9912422 [02:14<02:44, 33252.18it/s]     45%|████▌     | 4489216/9912422 [02:15<02:39, 33995.05it/s]     46%|████▌     | 4521984/9912422 [02:16<02:38, 34018.22it/s]     46%|████▌     | 4554752/9912422 [02:17<02:38, 33698.57it/s]     46%|████▋     | 4587520/9912422 [02:18<02:39, 33313.86it/s]     47%|████▋     | 4620288/9912422 [02:19<02:40, 32891.66it/s]     47%|████▋     | 4653056/9912422 [02:20<02:41, 32603.86it/s]     47%|████▋     | 4685824/9912422 [02:21<02:41, 32403.23it/s]     48%|████▊     | 4718592/9912422 [02:22<02:40, 32264.43it/s]     48%|████▊     | 4751360/9912422 [02:23<02:40, 32167.83it/s]     48%|████▊     | 4784128/9912422 [02:24<02:39, 32101.28it/s]     49%|████▊     | 4816896/9912422 [02:25<02:38, 32054.86it/s]     49%|████▉     | 4849664/9912422 [02:26<02:38, 32022.83it/s]     49%|████▉     | 4882432/9912422 [02:27<02:37, 31999.48it/s]     50%|████▉     | 4915200/9912422 [02:28<02:36, 31984.64it/s]     50%|████▉     | 4947968/9912422 [02:29<02:35, 31974.94it/s]     50%|█████     | 4980736/9912422 [02:30<02:34, 31968.76it/s]     51%|█████     | 5013504/9912422 [02:31<02:33, 31965.50it/s]     51%|█████     | 5046272/9912422 [02:32<02:32, 31963.58it/s]     51%|█████     | 5079040/9912422 [02:33<02:31, 31960.82it/s]     52%|█████▏    | 5111808/9912422 [02:34<02:30, 31959.90it/s]     52%|█████▏    | 5144576/9912422 [02:35<02:29, 31959.24it/s]     52%|█████▏    | 5177344/9912422 [02:36<02:28, 31957.80it/s]     53%|█████▎    | 5210112/9912422 [02:37<02:25, 32259.75it/s]     53%|█████▎    | 5242880/9912422 [02:38<02:22, 32784.66it/s]     53%|█████▎    | 5275648/9912422 [02:39<02:19, 33167.28it/s]     54%|█████▎    | 5308416/9912422 [02:40<02:17, 33437.45it/s]     54%|█████▍    | 5341184/9912422 [02:41<02:14, 33965.79it/s]     54%|█████▍    | 5373952/9912422 [02:42<02:10, 34694.51it/s]     55%|█████▍    | 5406720/9912422 [02:43<02:07, 35218.95it/s]     55%|█████▍    | 5439488/9912422 [02:44<02:05, 35599.92it/s]     55%|█████▌    | 5472256/9912422 [02:45<02:03, 35867.97it/s]     56%|█████▌    | 5505024/9912422 [02:46<02:03, 35682.68it/s]     56%|█████▌    | 5537792/9912422 [02:47<02:04, 35006.00it/s]     56%|█████▌    | 5570560/9912422 [02:48<02:05, 34721.89it/s]     57%|█████▋    | 5603328/9912422 [02:48<02:04, 34522.93it/s]     57%|█████▋    | 5636096/9912422 [02:49<02:04, 34384.41it/s]     57%|█████▋    | 5668864/9912422 [02:50<02:03, 34289.62it/s]     58%|█████▊    | 5701632/9912422 [02:51<02:03, 34223.22it/s]     58%|█████▊    | 5734400/9912422 [02:52<02:01, 34522.15it/s]     58%|█████▊    | 5767168/9912422 [02:53<02:00, 34380.79it/s]     59%|█████▊    | 5799936/9912422 [02:54<01:59, 34284.87it/s]     59%|█████▉    | 5832704/9912422 [02:55<01:59, 34215.40it/s]     59%|█████▉    | 5865472/9912422 [02:56<01:58, 34169.71it/s]     60%|█████▉    | 5898240/9912422 [02:57<01:58, 33964.28it/s]     60%|█████▉    | 5931008/9912422 [02:58<01:57, 33825.75it/s]     60%|██████    | 5963776/9912422 [02:59<01:57, 33560.03it/s]     60%|██████    | 5996544/9912422 [03:00<01:58, 33046.58it/s]     61%|██████    | 6029312/9912422 [03:01<01:58, 32715.13it/s]     61%|██████    | 6062080/9912422 [03:02<01:57, 32789.14it/s]     61%|██████▏   | 6094848/9912422 [03:03<01:55, 33159.68it/s]     62%|██████▏   | 6127616/9912422 [03:04<01:53, 33425.38it/s]     62%|██████▏   | 6160384/9912422 [03:05<01:50, 33946.76it/s]     62%|██████▏   | 6193152/9912422 [03:06<01:47, 34672.44it/s]     63%|██████▎   | 6225920/9912422 [03:07<01:44, 35198.25it/s]     63%|██████▎   | 6258688/9912422 [03:08<01:43, 35392.20it/s]     63%|██████▎   | 6291456/9912422 [03:09<01:42, 35348.38it/s]     64%|██████▍   | 6324224/9912422 [03:10<01:43, 34601.90it/s]     64%|██████▍   | 6356992/9912422 [03:11<01:43, 34442.51it/s]     64%|██████▍   | 6389760/9912422 [03:12<01:42, 34506.71it/s]     65%|██████▍   | 6422528/9912422 [03:13<01:42, 34206.51it/s]     65%|██████▌   | 6455296/9912422 [03:14<01:41, 33998.94it/s]     65%|██████▌   | 6488064/9912422 [03:14<01:41, 33853.24it/s]     66%|██████▌   | 6520832/9912422 [03:15<01:39, 33920.50it/s]     66%|██████▌   | 6553600/9912422 [03:16<01:38, 33967.32it/s]     66%|██████▋   | 6586368/9912422 [03:17<01:39, 33498.66it/s]     67%|██████▋   | 6619136/9912422 [03:18<01:38, 33502.77it/s]     67%|██████▋   | 6651904/9912422 [03:19<01:36, 33672.22it/s]     67%|██████▋   | 6684672/9912422 [03:20<01:35, 33791.71it/s]     68%|██████▊   | 6717440/9912422 [03:21<01:34, 33877.74it/s]     68%|██████▊   | 6750208/9912422 [03:22<01:33, 33935.81it/s]     68%|██████▊   | 6782976/9912422 [03:23<01:32, 33977.37it/s]     69%|██████▉   | 6815744/9912422 [03:24<01:31, 33837.26it/s]     69%|██████▉   | 6848512/9912422 [03:25<01:30, 33905.83it/s]     69%|██████▉   | 6881280/9912422 [03:26<01:30, 33453.44it/s]     70%|██████▉   | 6914048/9912422 [03:27<01:30, 32984.36it/s]     70%|███████   | 6946816/9912422 [03:28<01:30, 32665.84it/s]     70%|███████   | 6979584/9912422 [03:29<01:30, 32444.61it/s]     71%|███████   | 7012352/9912422 [03:30<01:29, 32292.81it/s]     71%|███████   | 7045120/9912422 [03:31<01:29, 32186.15it/s]     71%|███████▏  | 7077888/9912422 [03:32<01:28, 32109.95it/s]     72%|███████▏  | 7110656/9912422 [03:33<01:27, 32061.06it/s]     72%|███████▏  | 7143424/9912422 [03:34<01:26, 32024.06it/s]     72%|███████▏  | 7176192/9912422 [03:35<01:25, 31999.83it/s]     73%|███████▎  | 7208960/9912422 [03:36<01:24, 31981.29it/s]     73%|███████▎  | 7241728/9912422 [03:37<01:23, 31969.36it/s]     73%|███████▎  | 7274496/9912422 [03:38<01:22, 31962.07it/s]     74%|███████▎  | 7307264/9912422 [03:39<01:21, 31955.75it/s]     74%|███████▍  | 7340032/9912422 [03:41<01:20, 31950.89it/s]     74%|███████▍  | 7372800/9912422 [03:42<01:19, 31947.17it/s]     75%|███████▍  | 7405568/9912422 [03:43<01:18, 31946.16it/s]     75%|███████▌  | 7438336/9912422 [03:44<01:17, 31946.07it/s]     75%|███████▌  | 7471104/9912422 [03:45<01:16, 31943.09it/s]     76%|███████▌  | 7503872/9912422 [03:46<01:15, 31945.59it/s]     76%|███████▌  | 7536640/9912422 [03:47<01:14, 31948.83it/s]     76%|███████▋  | 7569408/9912422 [03:48<01:13, 31948.64it/s]     77%|███████▋  | 7602176/9912422 [03:49<01:11, 32403.33it/s]     77%|███████▋  | 7634944/9912422 [03:50<01:09, 32729.32it/s]     77%|███████▋  | 7667712/9912422 [03:51<01:07, 33282.59it/s]     78%|███████▊  | 7700480/9912422 [03:51<01:04, 34186.99it/s]     78%|███████▊  | 7733248/9912422 [03:52<01:02, 34850.59it/s]     78%|███████▊  | 7766016/9912422 [03:53<01:01, 34968.02it/s]     79%|███████▊  | 7798784/9912422 [03:54<01:00, 34694.47it/s]     79%|███████▉  | 7831552/9912422 [03:55<01:00, 34505.66it/s]     79%|███████▉  | 7864320/9912422 [03:56<00:59, 34201.17it/s]     80%|███████▉  | 7897088/9912422 [03:57<00:59, 33658.26it/s]     80%|███████▉  | 7929856/9912422 [03:58<00:59, 33125.24it/s]     80%|████████  | 7962624/9912422 [03:59<00:59, 32760.94it/s]     81%|████████  | 7995392/9912422 [04:00<00:58, 32511.39it/s]     81%|████████  | 8028160/9912422 [04:01<00:58, 32339.17it/s]     81%|████████▏ | 8060928/9912422 [04:02<00:57, 32220.04it/s]     82%|████████▏ | 8093696/9912422 [04:03<00:56, 32137.81it/s]     82%|████████▏ | 8126464/9912422 [04:04<00:55, 32078.94it/s]     82%|████████▏ | 8159232/9912422 [04:05<00:54, 32039.72it/s]     83%|████████▎ | 8192000/9912422 [04:06<00:53, 32010.84it/s]     83%|████████▎ | 8224768/9912422 [04:07<00:52, 31992.11it/s]     83%|████████▎ | 8257536/9912422 [04:09<00:51, 31978.74it/s]     84%|████████▎ | 8290304/9912422 [04:10<00:50, 31968.52it/s]     84%|████████▍ | 8323072/9912422 [04:11<00:49, 31961.61it/s]     84%|████████▍ | 8355840/9912422 [04:12<00:48, 31956.88it/s]     85%|████████▍ | 8388608/9912422 [04:13<00:47, 31953.94it/s]     85%|████████▍ | 8421376/9912422 [04:14<00:46, 31948.30it/s]     85%|████████▌ | 8454144/9912422 [04:15<00:45, 31947.44it/s]     86%|████████▌ | 8486912/9912422 [04:16<00:44, 31946.24it/s]     86%|████████▌ | 8519680/9912422 [04:17<00:43, 31945.48it/s]     86%|████████▋ | 8552448/9912422 [04:18<00:42, 31944.72it/s]     87%|████████▋ | 8585216/9912422 [04:19<00:41, 31945.04it/s]     87%|████████▋ | 8617984/9912422 [04:20<00:40, 31945.39it/s]     87%|████████▋ | 8650752/9912422 [04:21<00:39, 31945.27it/s]     88%|████████▊ | 8683520/9912422 [04:22<00:38, 31945.31it/s]     88%|████████▊ | 8716288/9912422 [04:23<00:37, 31946.39it/s]     88%|████████▊ | 8749056/9912422 [04:24<00:36, 31945.20it/s]     89%|████████▊ | 8781824/9912422 [04:25<00:34, 32401.26it/s]     89%|████████▉ | 8814592/9912422 [04:26<00:33, 32885.03it/s]     89%|████████▉ | 8847360/9912422 [04:27<00:32, 33233.58it/s]     90%|████████▉ | 8880128/9912422 [04:28<00:31, 32995.36it/s]     90%|████████▉ | 8912896/9912422 [04:29<00:30, 32672.65it/s]     90%|█████████ | 8945664/9912422 [04:30<00:29, 32450.60it/s]     91%|█████████ | 8978432/9912422 [04:31<00:28, 32297.88it/s]     91%|█████████ | 9011200/9912422 [04:32<00:27, 32190.22it/s]     91%|█████████ | 9043968/9912422 [04:33<00:27, 32118.40it/s]     92%|█████████▏| 9076736/9912422 [04:34<00:26, 32066.85it/s]     92%|█████████▏| 9109504/9912422 [04:35<00:25, 32029.82it/s]     92%|█████████▏| 9142272/9912422 [04:36<00:24, 32003.31it/s]     93%|█████████▎| 9175040/9912422 [04:37<00:23, 31987.96it/s]     93%|█████████▎| 9207808/9912422 [04:38<00:22, 31975.22it/s]     93%|█████████▎| 9240576/9912422 [04:39<00:21, 31966.43it/s]     94%|█████████▎| 9273344/9912422 [04:40<00:19, 31960.22it/s]     94%|█████████▍| 9306112/9912422 [04:41<00:18, 31956.51it/s]     94%|█████████▍| 9338880/9912422 [04:42<00:17, 31953.94it/s]     95%|█████████▍| 9371648/9912422 [04:43<00:16, 31952.80it/s]     95%|█████████▍| 9404416/9912422 [04:44<00:15, 31949.89it/s]     95%|█████████▌| 9437184/9912422 [04:45<00:14, 31951.89it/s]     96%|█████████▌| 9469952/9912422 [04:46<00:13, 32406.27it/s]     96%|█████████▌| 9502720/9912422 [04:47<00:12, 32268.24it/s]     96%|█████████▌| 9535488/9912422 [04:48<00:11, 32792.36it/s]     97%|█████████▋| 9568256/9912422 [04:49<00:10, 33007.50it/s]     97%|█████████▋| 9601024/9912422 [04:50<00:09, 33321.25it/s]     97%|█████████▋| 9633792/9912422 [04:51<00:08, 33543.61it/s]     98%|█████████▊| 9666560/9912422 [04:52<00:07, 33211.61it/s]     98%|█████████▊| 9699328/9912422 [04:53<00:06, 33303.55it/s]     98%|█████████▊| 9732096/9912422 [04:54<00:05, 33367.57it/s]     99%|█████████▊| 9764864/9912422 [04:55<00:04, 33412.31it/s]     99%|█████████▉| 9797632/9912422 [04:56<00:03, 33607.69it/s]     99%|█████████▉| 9830400/9912422 [04:57<00:02, 33747.43it/s]    100%|█████████▉| 9863168/9912422 [04:58<00:01, 33677.94it/s]    100%|█████████▉| 9895936/9912422 [04:59<00:00, 33794.97it/s]    100%|██████████| 9912422/9912422 [05:00<00:00, 31122.39it/s]    100%|██████████| 9912422/9912422 [05:00<00:00, 33025.85it/s]
    Extracting ./datasets/MNIST/raw/train-images-idx3-ubyte.gz to ./datasets/MNIST/raw

    Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz to ./datasets/MNIST/raw/train-labels-idx1-ubyte.gz
      0%|          | 0/28881 [00:00<?, ?it/s]    100%|██████████| 28881/28881 [00:00<00:00, 3483313.03it/s]
    Extracting ./datasets/MNIST/raw/train-labels-idx1-ubyte.gz to ./datasets/MNIST/raw

    Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz to ./datasets/MNIST/raw/t10k-images-idx3-ubyte.gz
      0%|          | 0/1648877 [00:00<?, ?it/s]      2%|▏         | 32768/1648877 [00:00<00:36, 44541.56it/s]      4%|▍         | 65536/1648877 [00:01<00:42, 37212.80it/s]      6%|▌         | 98304/1648877 [00:02<00:44, 34606.12it/s]      8%|▊         | 131072/1648877 [00:03<00:45, 33505.61it/s]     10%|▉         | 163840/1648877 [00:04<00:45, 32924.79it/s]     12%|█▏        | 196608/1648877 [00:05<00:44, 32586.32it/s]     14%|█▍        | 229376/1648877 [00:06<00:43, 32373.41it/s]     16%|█▌        | 262144/1648877 [00:07<00:43, 32235.88it/s]     18%|█▊        | 294912/1648877 [00:08<00:41, 32788.28it/s]     20%|█▉        | 327680/1648877 [00:09<00:39, 33174.65it/s]     22%|██▏       | 360448/1648877 [00:10<00:38, 33277.98it/s]     24%|██▍       | 393216/1648877 [00:11<00:37, 33516.11it/s]     26%|██▌       | 425984/1648877 [00:12<00:36, 33682.95it/s]     28%|██▊       | 458752/1648877 [00:13<00:35, 33799.35it/s]     30%|██▉       | 491520/1648877 [00:14<00:34, 33881.29it/s]     32%|███▏      | 524288/1648877 [00:15<00:33, 33273.87it/s]     34%|███▍      | 557056/1648877 [00:16<00:33, 32862.54it/s]     36%|███▌      | 589824/1648877 [00:17<00:31, 33218.67it/s]     38%|███▊      | 622592/1648877 [00:18<00:30, 33470.94it/s]     40%|███▉      | 655360/1648877 [00:19<00:29, 33649.88it/s]     42%|████▏     | 688128/1648877 [00:20<00:28, 33609.82it/s]     44%|████▎     | 720896/1648877 [00:21<00:27, 33747.73it/s]     46%|████▌     | 753664/1648877 [00:22<00:26, 33844.44it/s]     48%|████▊     | 786432/1648877 [00:23<00:25, 33414.52it/s]     50%|████▉     | 819200/1648877 [00:24<00:25, 32959.37it/s]     52%|█████▏    | 851968/1648877 [00:25<00:24, 32647.58it/s]     54%|█████▎    | 884736/1648877 [00:26<00:23, 32434.25it/s]     56%|█████▌    | 917504/1648877 [00:27<00:22, 32285.69it/s]     58%|█████▊    | 950272/1648877 [00:28<00:21, 32646.29it/s]     60%|█████▉    | 983040/1648877 [00:29<00:20, 32897.22it/s]     62%|██████▏   | 1015808/1648877 [00:30<00:19, 33087.16it/s]     64%|██████▎   | 1048576/1648877 [00:31<00:17, 33376.35it/s]     66%|██████▌   | 1081344/1648877 [00:32<00:16, 33582.64it/s]     68%|██████▊   | 1114112/1648877 [00:33<00:15, 33728.60it/s]     70%|██████▉   | 1146880/1648877 [00:34<00:14, 33831.41it/s]     72%|███████▏  | 1179648/1648877 [00:35<00:14, 33407.06it/s]     74%|███████▎  | 1212416/1648877 [00:36<00:13, 33438.29it/s]     76%|███████▌  | 1245184/1648877 [00:37<00:12, 33626.02it/s]     78%|███████▊  | 1277952/1648877 [00:38<00:10, 33758.54it/s]     79%|███████▉  | 1310720/1648877 [00:39<00:09, 33852.78it/s]     81%|████████▏ | 1343488/1648877 [00:40<00:09, 33918.20it/s]     83%|████████▎ | 1376256/1648877 [00:41<00:08, 33795.35it/s]     85%|████████▌ | 1409024/1648877 [00:42<00:07, 33218.47it/s]     87%|████████▋ | 1441792/1648877 [00:43<00:06, 32827.20it/s]     89%|████████▉ | 1474560/1648877 [00:44<00:05, 32556.64it/s]     91%|█████████▏| 1507328/1648877 [00:45<00:04, 32370.01it/s]     93%|█████████▎| 1540096/1648877 [00:46<00:03, 32242.18it/s]     95%|█████████▌| 1572864/1648877 [00:47<00:02, 32154.49it/s]     97%|█████████▋| 1605632/1648877 [00:48<00:01, 32091.25it/s]     99%|█████████▉| 1638400/1648877 [00:49<00:00, 32046.94it/s]    100%|██████████| 1648877/1648877 [00:49<00:00, 29269.23it/s]    100%|██████████| 1648877/1648877 [00:49<00:00, 33008.61it/s]
    Extracting ./datasets/MNIST/raw/t10k-images-idx3-ubyte.gz to ./datasets/MNIST/raw

    Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to ./datasets/MNIST/raw/t10k-labels-idx1-ubyte.gz
      0%|          | 0/4542 [00:00<?, ?it/s]    100%|██████████| 4542/4542 [00:00<00:00, 36149010.94it/s]
    Extracting ./datasets/MNIST/raw/t10k-labels-idx1-ubyte.gz to ./datasets/MNIST/raw

    /home/circleci/project/skada/datasets/_mnist_usps.py:72: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
      mnist_target = torch.tensor(mnist_dataset.targets)
    Downloading https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/usps.t.bz2 to ./datasets/usps.t.bz2
      0%|          | 0/1831726 [00:00<?, ?it/s]      2%|▏         | 32768/1831726 [00:00<00:10, 164793.13it/s]      4%|▎         | 65536/1831726 [00:00<00:10, 164978.73it/s]      5%|▌         | 98304/1831726 [00:00<00:10, 165100.24it/s]      9%|▉         | 163840/1831726 [00:00<00:07, 230439.81it/s]     20%|█▉        | 360448/1831726 [00:00<00:02, 503525.05it/s]     39%|███▉      | 720896/1831726 [00:01<00:01, 949915.13it/s]     79%|███████▊  | 1441792/1831726 [00:01<00:00, 1828109.80it/s]    100%|██████████| 1831726/1831726 [00:01<00:00, 1314871.13it/s]




.. GENERATED FROM PYTHON SOURCE LINES 35-37

Train a classic model
----------------------------------------------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 37-48

.. code-block:: Python

    model = NeuralNetClassifier(
        MNISTtoUSPSNet(),
        criterion=nn.CrossEntropyLoss(),
        batch_size=128,
        max_epochs=5,
        train_split=False,
        lr=1e-2,
    )
    model.fit(X[sample_domain > 0], y[sample_domain > 0])
    model.score(X_test, y=y_test)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      epoch    train_loss      dur
    -------  ------------  -------
          1        1.4353  40.5931
          2        0.2654  30.9950
          3        0.1086  24.2005
          4        0.0691  10.3080
          5        0.0457  12.2909

    0.9035369774919614



.. GENERATED FROM PYTHON SOURCE LINES 49-51

Train a DeepCoral model
----------------------------------------------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 51-62

.. code-block:: Python

    model = DeepCoral(
        MNISTtoUSPSNet(),
        layer_name="fc1",
        batch_size=128,
        max_epochs=5,
        train_split=False,
        reg=1,
        lr=1e-2,
    )
    model.fit(X, y, sample_domain=sample_domain)
    model.score(X_test, y_test, sample_domain=sample_domain_test)




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      epoch    train_loss      dur
    -------  ------------  -------
          1        1.5628  44.9888
          2        0.3413  35.9897
          3        0.1668  38.4053
          4        0.1166  24.3005
          5        0.0948  25.1999

    0.9003215434083601




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (10 minutes 54.060 seconds)


.. _sphx_glr_download_auto_examples_deep_plot_divergence.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_divergence.ipynb <plot_divergence.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_divergence.py <plot_divergence.py>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
